#!name=Sxw Surge
#!desc=sxw 自用规则
#!system=mac

[General]
# ========== 代理监听 ==========
http-listen = 127.0.0.1:7891
socks5-listen = 127.0.0.1:7890

# ========== DNS 配置 ==========
# 内网DNS优先，保证内网域名解析正确
# 注意：不要将公网 DNS 与 system 混用，否则公网 DNS 返回 NXDOMAIN 可能抢先生效导致内网解析失败
dns-server = system
# 备用方案（仅在 system 完全不可用时手动切换）：
# dns-server = system, 223.5.5.5, 1.1.1.1
# doh-server = https://223.5.5.5/dns-query, https://1.1.1.1/dns-query, https://8.8.8.8/dns-query
# encrypted-dns-follow-outbound-mode = true

# ========== 性能优化 ==========
# hijack-dns = 223.5.5.5:53, 119.29.29.29:53
use-local-host-item-for-proxy = true
# 强制关闭 IPv6 以避免内网 AAAA 查询超时
ipv6 = false
# ipv6-vif = auto
# enhanced-mode-by-rule = true
exclude-simple-hostnames = true
show-error-page-for-reject = true
always-real-ip = *.qihoo.net, *.qiwoo.org

# ========== 跳过代理 ==========
skip-proxy = %APPEND% 192.168.0.0/16, 10.0.0.0/8, 172.16.0.0/12, 127.0.0.0/8, 100.64.0.0/10, fc00::/7, fe80::/10, localhost
# bypass-tun = 192.168.0.0/16, 10.0.0.0/8, 172.16.0.0/12, 127.0.0.0/8, 169.254.0.0/16, 224.0.0.0/4, 255.255.255.255/32, fc00::/7, fe80::/10, ff00::/8, localhost

[Host]
# 内网域名直接IP映射，绕过DNS解析
# 由 update_surge_hosts.py 自动生成
console.browser.qihoo.net = 11.136.224.158
smkill8.mobi.zzzc.qihoo.net = 10.172.173.119
mse.add.qihoo.net = 11.136.228.177
wiki.mobilesafe.corp.qihoo.net = 10.16.94.60
hulk.corp.qihoo.net = 10.220.192.90
coding.qihoo.net = 10.220.162.213
test.member.shouji.qihoo.net = 10.236.165.24
test2.member.shouji.qihoo.net = 10.236.165.24
test.v5x.shouji.qihoo.net = 11.136.236.147
v5x.shouji.qihoo.net = 10.220.162.243
yapi.mobile.qihoo.net = 10.216.193.105
v.src.corp.qihoo.net = 10.16.22.20
doc.qiwoo.org = 10.206.240.212
geelib.qihoo.net = 10.16.101.51
device.mobilesafe.corp.qihoo.net = 10.16.49.74

# 泛域名DNS解析（作为备用）
# 使用 syslib 而不是 system，以利用 macOS 系统级解析器处理复杂的内网 DNS/VPN 环境
*.qihoo.net = server:syslib
*.qiwoo.org = server:syslib
*.corp.qihoo.net = server:syslib
# 通用内网域名后缀使用系统库解析 (syslib)
*.local = server:syslib
*.lan = server:syslib
[Rule]
# 指定 IP 直连（由 update_surge_hosts.py 自动生成）
IP-CIDR,8.213.207.142/32,DIRECT,no-resolve
# 内网域名直连
DOMAIN-SUFFIX,qihoo.net,DIRECT
DOMAIN-SUFFIX,qiwoo.org,DIRECT

# 最终规则：未匹配的流量走直连
# FINAL,DIRECT
IP-CIDR,192.168.0.0/16,DIRECT,no-resolve
IP-CIDR,10.0.0.0/8,DIRECT,no-resolve
IP-CIDR,172.16.0.0/12,DIRECT,no-resolve
IP-CIDR,127.0.0.0/8,DIRECT,no-resolve
IP-CIDR,100.64.0.0/10,DIRECT,no-resolve
IP-CIDR6,fc00::/7,DIRECT
IP-CIDR6,fe80::/10,DIRECT
